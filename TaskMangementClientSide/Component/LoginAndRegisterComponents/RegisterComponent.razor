@using Task.Application.DTOs
@inject HttpClient Http
@inject IJSRuntime JS
@inject NavigationManager nav


<div class="d-flex justify-content-center align-items-center min-vh-100 bg-light">
    <div class="card p-4 shadow-lg border-0 rounded-4" style="max-width: 400px; width: 100%;">

        <!-- Logo or Title -->
        <div class="text-center mb-3">
            <img src="images/TaskMa.png" alt="Logo" width="80" class="mb-2 rounded-circle shadow-sm" />
            <h4 class="fw-bold" style="color:#2c3e50;">Create Account</h4>
            <p class="text-muted small mb-0">Join us and start managing your tasks efficiently</p>
        </div>

        <!-- Registration Form -->
        <!-- Registration Form -->
        <EditForm Model="@registerModel" OnValidSubmit="HandleRegister">
            <DataAnnotationsValidator />
          


                <!-- Name -->
            <div class="mb-3">
                <label class="form-label fw-semibold">Full Name<span class="text-danger">*</span></label>
                    <div class="input-group ">
                        <span class="input-group-text bg-light"><i class="bi bi-person"></i></span>
                        <InputText class="form-control" @bind-Value="registerModel.Name" placeholder="Enter your name" />
                    </div>
                    <ValidationMessage For="@(() => registerModel.Name)" class="text-danger small" />
                        </div>
              

                <!-- Email -->
            <div class="mb-3">
                <label class="form-label fw-semibold">Email<span class="text-danger">*</span></label>
                    <div class="input-group ">
                        <span class="input-group-text bg-light"><i class="bi bi-envelope"></i></span>
                        <InputText type="email" class="form-control" @bind-Value="registerModel.Email" placeholder="Enter your email" />
                    </div>
                    <ValidationMessage For="@(() => registerModel.Email)" class="text-danger small" />
               </div>

                <!-- Password -->
            <div class="mb-3">
                    <label class="form-label fw-semibold">Password<span class="text-danger">*</span></label>
                    <div class="input-group input-group-sm">
                        <span class="input-group-text bg-light"><i class="bi bi-lock"></i></span>
                        <InputText type="password" class="form-control" @bind-Value="registerModel.Password" placeholder="Enter password" />
                    </div>
                    <ValidationMessage For="@(() => registerModel.Password)" class="text-danger small" />
                </div>

                <!-- Confirm Password -->
            <div class="mb-3">
                    <label class="form-label fw-semibold">Confirm Password<span class="text-danger">*</span></label>
                    <div class="input-group input-group-sm">
                        <span class="input-group-text bg-light"><i class="bi bi-shield-lock"></i></span>
                        <InputText type="password" class="form-control" @bind-Value="registerModel.ConfirmPassword" placeholder="Re-enter password" />
                    </div>
                    <ValidationMessage For="@(() => registerModel.ConfirmPassword)" class="text-danger small" />
                </div>
            

            <button class="btn btn-outline-dark w-100  py-2 fw-semibold"  type="submit">
                <i class="bi bi-person-plus me-2"></i>Register
            </button>
        </EditForm>
        <style>
            .btn-outline-dark {
                background-color: #2c3e50 !important;
                color: white !important;
            }

                .btn-outline-dark:hover {
                    background-color: #0d6efd !important;
                    color: white !important;
                }

            a.login-link {
                color: #0d6efd;
                text-decoration: underline;
                font-weight: 500;
                transition: all 0.3s ease;
            }

                a.login-link:hover {
                    /* blue on hover */
                    color: #2c3e50;
                    /* underline on hover */
                    transform: translateY(-1px);
                }
        </style>


        @if (!string.IsNullOrEmpty(message))
        {
            <div class="alert alert-info mt-3 text-center py-2">@message</div>
        }

        <div class="text-center mt-2">
            <small class="text-muted">
                Already have an account?
                <a href="/member" class="login-link">Login</a>
            </small>
        </div>
    </div>
</div>


@code {
    [Parameter] public RegisterDto registerModel { get; set; } = new();
    [Parameter] public EventCallback<bool> OnRegisterResult { get; set; }

    private string? message;

    private async Task HandleRegister()
    {
        if (registerModel.Password != registerModel.ConfirmPassword)
        {
            message = "Passwords do not match.";
            await OnRegisterResult.InvokeAsync(false);
            return;
        }

        try
        {
            message = "Registering...";
            var response = await Http.PostAsJsonAsync("api/Auth/register", registerModel);

            if (response.IsSuccessStatusCode)
            {
                message = "Registration successful!";
                await OnRegisterResult.InvokeAsync(true);
                await JS.InvokeVoidAsync("setTimeout", EventCallback.Factory.Create(this, () => nav.NavigateTo("/login")), 1500);
            }
            else
            {
                var error = await response.Content.ReadAsStringAsync();
                message = $"Registration failed: {error}";
                await OnRegisterResult.InvokeAsync(false);
            }
        }
        catch (Exception ex)
        {
            message = $"Error: {ex.Message}";
            await OnRegisterResult.InvokeAsync(false);
        }
    }
}